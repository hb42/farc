<div class="card" >
  <div class="card-body bg-light200" >
    <p-breadcrumb [model]="farcService.breadcrumbs"></p-breadcrumb>
  </div>
</div>

<!-- damit Scrolling fkt. muss dataTable mit div umgeben werden -->
<div id="filelisttable" class="flex-panel flex-content-fix" >
  <p-table #filetable
           [value]="farcService.virtualfiles"
           [scrollable]="true"
           scrollHeight="100%"
           [(selection)]="farcService.selectedFiles"
           (onHeaderCheckboxToggle)="farcService.selectAll($event)"
           [loading]="farcService.loading"
           loadingIcon="fa fa-cog fa-spin"
           [rowTrackBy]="farcService.rowTrackBy"
           dataKey="entryid"
           [customSort]="true"
           (sortFunction)="farcService.onSort($event)"
           [sortField]="farcService.sortField"
           [sortOrder]="farcService.sortOrder"
           [virtualScroll]="true"
           [virtualScrollDelay]="farcService.virtualScrollDelay"
           (onLazyLoad)="farcService.loadFilesOnScroll($event)"
           [lazy]="true"
           [totalRecords]="farcService.totalRows"
           [virtualRowHeight]="38"
           [rows]="farcService.lazyRows"
  >
    <!--<ng-template pTemplate="caption">-->

    <!--</ng-template>-->
    <ng-template pTemplate="emptymessage">
      Keine Dateien gefunden.
    </ng-template>
    <ng-template pTemplate="colgroup" let-columns>
      <colgroup>
        <col style="width: 38px">
        <col>
        <col style="width: 100px">
        <col style="width: 180px">
        <col style="width: 180px">
      </colgroup>
    </ng-template>
    <ng-template pTemplate="header" let-columns>
      <tr>
        <th>
          <p-tableHeaderCheckbox *ngIf="farcService.isNodeSelectable()"></p-tableHeaderCheckbox>
        </th>
        <th [pSortableColumn]="'label'">
          Name
          <p-sortIcon [field]="'label'"></p-sortIcon>
        </th>
        <th [pSortableColumn]="'size'" class="center-align">
          Belegt
          <p-sortIcon [field]="'size'"></p-sortIcon>
        </th>
        <th [pSortableColumn]="'timestamp'" class="center-align">
          Datum
          <p-sortIcon [field]="'timestamp'"></p-sortIcon>
        </th>
        <th>Vorgemerkt für</th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-rowData let-columns="columns" let-rowIndex="rowIndex">
      <tr [pSelectableRow]="rowData" style="height:38px">
        <td>
          <p-tableCheckbox *ngIf="farcService.isNodeSelectable()" [value]="rowData"></p-tableCheckbox>
        </td>
        <td>
            <div *ngIf="rowData.type === 'file';then fileRow else dirRow"></div>
            <ng-template #fileRow>
              <div title="{{farcService.fullPath(rowData)}}" [class.archivenode]="rowData.arc">
                <i class="fa fa-file-o fa-fw"></i> {{rowData.label}}
              </div>
            </ng-template>
            <ng-template #dirRow >
              <div><a class="btn link" (click)="farcService.expandTo(rowData.path)" title="{{farcService.fullPath(rowData)}}" tabindex="{{10000 + rowIndex}}">
                <i class="fa fa-folder-open fa-fw"></i> {{rowData.label}}
              </a></div>
            </ng-template>
        </td>
        <td class="right-align">{{rowData.size | filesize }}</td>
        <td class="right-align">{{rowData.timestamp | date:'medium' }}</td>
        <td>
          <div *ngIf="rowData.selected > 0" class="right-align">
            <mark title="{{rowData.selectUid}} - {{rowData.selectDate | date:'medium'}}"
                  [class.inheritselect]="!farcService.isNodeSelectable()">
              {{rowData.selected | vormerk }}
              <button *ngIf="farcService.isNodeSelectable()"
                      class="btn btn-link text-success iconbtn"
                      (click)="farcService.execVormerk(rowData)"
                      title="Vormerkung sofort ausführen">
                <i class="fa fa-check-circle"></i>
              </button>
              <button *ngIf="farcService.isNodeSelectable()"
                      class="btn btn-link text-danger iconbtn"
                      (click)="farcService.undoSelectionFor(rowData)"
                      title="Vormerkung entfernen">
                <i class="fa fa-times-circle"></i>
              </button>
            </mark>
          </div>
        </td>
      </tr>
    </ng-template>
    <!--<ng-template pTemplate="summary">-->
    <!--</ng-template>-->
  </p-table>
</div>

<div class="navbar navbar-light bg-light200 justify-content-between">
  <div >
  <div *ngIf="farcService.selectedNode && farcService.selectedNode.type !== 'strukt' && farcService.selectedFiles.length > 0"
       class=" button-height">
    <button class="btn btn-sm btn-warning"
            (click)="farcService.moveSelected()"
            title="{{farcService.selectedNode.arc ? 'Auswahl aus dem Archiv zurückkopieren'
                                                  : 'Auswahl ins Archiv verschieben'}}">
      <i class="fa fa-plus"></i> {{farcService.selectedNode.arc ? "Zurücksichern" : "Archivieren"}}
    </button>
    <button class="btn btn-sm btn-warning"
            (click)="farcService.delSelected()"
            title="Ausgewählte Dateien und Verzeichnisse fürs Löschen vormerken">
      <i class="fa fa-trash"></i> Löschen
    </button>
    <button class="btn btn-sm btn-warning" [class.disabled]="!farcService.vormerkInSelected()"
            (click)="farcService.undoSelection()"
            title="Vorhandene Vormerkungen für die ausgewählten Dateien und Verzeichnisse entfernen">
      <i class="fa fa-times-circle"></i> Vormerkung entfernen
    </button>
  </div>
  </div>
  <div  class="small sum-panel">
    <div class="sum-line full-sum"> {{farcService.files | filesSum:"all"}} </div> <br/>
    <div class="sum-line" >
      <span *ngIf="farcService.selectedFiles.length" class="ui-state-highlight select-sum" > {{farcService.selectedFiles | filesSum:"sum" }} ausgewählt </span>
      <mark *ngIf="farcService.isVormerk()" class="todo-sum"> {{farcService.vormerkList() | filesSum:"sum"}} vorgemerkt </mark>
    </div>
  </div>
</div>
